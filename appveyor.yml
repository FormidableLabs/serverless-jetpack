environment:
  matrix:
    # Limit windows builds because they're 15 mins in serial.
    # - nodejs_version: "10"
    - nodejs_version: "12"
    # - nodejs_version: "13"

matrix:
  fast_finish: true

branches:
  only:
    - master

install:
  - ps: Install-Product node $env:nodejs_version
  # Fail if lockfile outdated.
  # https://yarnpkg.com/lang/en/docs/cli/install/#toc-yarn-install-frozen-lockfile
  - yarn install --frozen-lockfile
  # Install `test/packages` dependencies.
  - yarn benchmark:install

test_script:
  # Info
  - node --version
  - yarn --version
  - npm --version

  # Build
  - yarn run check
  - yarn test:cli
  - yarn benchmark --parallel
  - yarn benchmark:test

# Don't actually build.
build: off

# Note: Enable `Save build cache in Pull Requests` in settings to get PR cache.
# See: https://www.appveyor.com/docs/build-cache/
cache:
  # Root project
  - node_modules -> yarn.lock
  # User-wide
  - '%LOCALAPPDATA%/Yarn'
  - '%APPDATA%\npm-cache'
